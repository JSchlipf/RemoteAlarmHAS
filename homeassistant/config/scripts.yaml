play_internet_radio:
  alias: "Play/Pause Internet Radio"
  sequence:
    - service: script.turn_off
      target:
        entity_id: script.play_radio_at_time  # Cancel the play_radio_at_time script
    - choose:
        - conditions:
            - condition: state
              entity_id: media_player.kitchen_speaker  # Replace with your smart speaker's entity ID
              state: "playing"
          sequence:
            - service: media_player.media_stop
              target:
                entity_id: media_player.kitchen_speaker
      default:
        - service: media_player.play_media
          target:
            entity_id: media_player.kitchen_speaker
          data:
            media_content_id: "https://nwm-lb-4.streamguys1.com/WCIC-MP3"  # Replace with the URL of the radio stream
            media_content_type: "music"
            
            
play_radio_at_time:
  alias: "Play Radio at Time"
  sequence:
    - variables:
        current_time: "{{ now().timestamp() }}"
        alarm_time: >
          {{ (now().replace(hour=states('input_datetime.alarm_time').split(':')[0]|int,
                            minute=states('input_datetime.alarm_time').split(':')[1]|int,
                            second=0, microsecond=0)
              + timedelta(days=1) if now() > now().replace(hour=states('input_datetime.alarm_time').split(':')[0]|int,
                                                           minute=states('input_datetime.alarm_time').split(':')[1]|int,
                                                           second=0, microsecond=0) else now().replace(hour=states('input_datetime.alarm_time').split(':')[0]|int,
                                                                                                       minute=states('input_datetime.alarm_time').split(':')[1]|int,
                                                                                                       second=0, microsecond=0) ).timestamp() }}
        delay_seconds: >
          {{ (alarm_time - current_time) if (alarm_time - current_time) > 0 else 0 }}
    - delay: "{{ delay_seconds | int }}"
    - service: media_player.volume_set
      target:
        entity_id: media_player.kitchen_speaker  # Replace with your smart speaker's entity ID
      data:
        volume_level: 0.05  # Set initial volume to 5%
    - service: media_player.play_media
      target:
        entity_id: media_player.kitchen_speaker
      data:
        media_content_id: "https://nwm-lb-4.streamguys1.com/WCIC-MP3"  # Replace with the URL of the radio stream
        media_content_type: "music"
    - repeat:
        count: 19  # Increase volume 19 times (5% to 100%)
        sequence:
          - delay: "00:00:20"  # Wait 20 seconds
          - service: media_player.volume_set
            target:
              entity_id: media_player.kitchen_speaker
            data:
              volume_level: >
                {{ state_attr('media_player.kitchen_speaker', 'volume_level') + 0.05 }}